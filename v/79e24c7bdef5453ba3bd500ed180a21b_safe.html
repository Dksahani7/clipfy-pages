<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>üê∂ ‡§≠‡§æ‡§≠‡•Ä ‡§ï‡•Ä ‡§Æ‡•ã‡§ü‡•Ä ‡§ó‡§æ‡§Ç‡§° ‡§°‡•â‡§ó‡•Ä ‡§∏‡•ç‡§ü‡§æ‡§á‡§≤ ‡§Æ‡•á‡§Ç ‡§†‡•ã‡§ï‡•Ä üòà | Clipfy Player</title>

<meta property="og:title" content="üê∂ ‡§≠‡§æ‡§≠‡•Ä ‡§ï‡•Ä ‡§Æ‡•ã‡§ü‡•Ä ‡§ó‡§æ‡§Ç‡§° ‡§°‡•â‡§ó‡•Ä ‡§∏‡•ç‡§ü‡§æ‡§á‡§≤ ‡§Æ‡•á‡§Ç ‡§†‡•ã‡§ï‡•Ä üòà">
<meta property="og:description" content="">
<meta property="og:type" content="video.other">

<meta property="og:image" content="https://pub-a3ad4cec48664940879fc5dd37a07293.r2.dev/thumbs/79e24c7bdef5453ba3bd500ed180a21b_blur.jpg">
<meta name="twitter:image" content="https://pub-a3ad4cec48664940879fc5dd37a07293.r2.dev/thumbs/79e24c7bdef5453ba3bd500ed180a21b_blur.jpg">
<meta name="twitter:card" content="summary_large_image">

<style>
    body{
      background:#0f141a;
      color:#fff;
      font-family:Arial, sans-serif;
      margin:0;
      padding:0;
      overflow-x:hidden;
    }
    /* Prevent ads from covering video player */
    .video-box{
      width:100%;
      height:40vh;
      position:fixed;
      top:0;
      left:0;
      background:#000;
      overflow:hidden;
      /* keep video below ad layers so floating/footer ads appear on top */
      z-index:9998;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .video-box video{
      width:100%;
      height:100%;
      object-fit:contain;
    }
    .floating-ad-320x50{
      position:fixed;
      top:4px;
      left:50%;
      transform:translateX(-50%);
      z-index:10000;
      width:320px;
      max-width:95%;
      height:50px;
      pointer-events:auto;
    }
    .content-wrapper{ padding-top:40vh; min-height:200vh; }
    .top-thin-ad{ background:#1a2430; padding:6px 0; margin:0; text-align:center; border-bottom:1px solid #222; }
    .top-thin-ad-inner{ width:728px; max-width:95%; height:90px; margin:0 auto; }
    .post{ padding:10px 16px; display:flex; gap:10px; align-items:center; border-bottom:1px solid #222; }
    .dp{ width:42px; height:42px; border-radius:50%; background:#555; }
    #creatorName{ font-weight:600; font-size:15px; }
    #timeAgo{ font-size:12px; color:#aaa; margin-top:2px; }
    .stats{ display:flex; gap:14px; padding:8px 16px; border-bottom:1px solid #222; font-size:13px; align-items:center; }
    .stat-item{ display:flex; align-items:center; gap:4px; color:#d0d0d0; }
    .stat-icon{ width:14px; height:14px; stroke:#d0d0d0; fill:none; }
    .stats-right{ margin-left:auto; cursor:pointer; font-size:13px; }
    .blog-content{ padding:14px 16px; font-size:15px; line-height:1.5; }
    #mainTitle{ margin:0 0 6px 0; font-size:18px; font-weight:600; }
    .suggestions-header{ padding:10px 16px; font-size:16px; font-weight:700; border-top:1px solid #222; }
    .video-suggestions-list{ background:transparent; }
    .suggestion-item{ display:block; width:100%; padding:10px 16px 14px; cursor:pointer; border-bottom:1px solid #1a2430; transition:background .12s; }
    .suggestion-item:hover{ background:#0b1216; }
    .suggestion-thumbnail{ width:100%; aspect-ratio:16/9; background:#333; border-radius:6px; overflow:hidden; margin-bottom:8px; }
    .suggestion-thumbnail img{ width:100%; height:100%; object-fit:cover; display:block; }
    .suggestion-details{ display:flex; flex-direction:column; justify-content:center; }
    .suggestion-title{ font-weight:600; font-size:15px; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; }
    .suggestion-creator{ font-size:12px; color:#aaa; margin-top:3px; }
    .suggested-ad-slot{ display:flex; justify-content:center; padding:12px 0; border-bottom:1px solid #222; background:transparent; }
    .footer-ad-320x50{ position:fixed; bottom:0; left:0; width:100%; z-index:10001; background:#000; display:flex; justify-content:center; padding:4px 0; }
    .footer-ad-inner{ width:320px; max-width:95%; height:50px; }
    .social-bar-wrap{ position:fixed; bottom:60px; right:8px; z-index:10002; }
    .hidden{display:none!important;}
  </style>
</head>
<body>

  <div class="floating-ad-320x50" id="floatingAd320x50"></div>

  <div class="video-box">
    <video id="player" playsinline controls autoplay muted>
      <source src="https://pub-a3ad4cec48664940879fc5dd37a07293.r2.dev/videos/79e24c7bdef5453ba3bd500ed180a21b.mp4" type="video/mp4">
    </video>
  </div>

  <div class="content-wrapper">

    <div class="top-thin-ad">
      <div class="top-thin-ad-inner" id="topThinAdInner"></div>
    </div>

    <div class="post">
      <div class="dp" id="creatorDp"></div>
      <div>
        <div id="creatorName">Clipfy Videos</div>
        <div id="timeAgo">just now</div>
      </div>
    </div>

    <div class="stats">
      <div class="stat-item">
        <svg class="stat-icon" viewBox="0 0 24 24"><path d="M2 12s3.5-6 10-6 10 6 10 6-3.5 6-10 6-10-6-10-6z"/><circle cx="12" cy="12" r="3"/></svg>
        <span id="views">{{VIEWS}}</span>
      </div>

      <div class="stat-item">
        <svg class="stat-icon" viewBox="0 0 24 24"><path d="M12 21s-5-3.3-8-6.7C2 12.5 2 9.5 4 7.5 5.1 6.4 6.6 6 8 6c1.6 0 3.1.8 4 2 0.9-1.2 2.4-2 4-2 1.4 0 2.9.4 4 1.5 2 2 2 5 0 6.8C17 17.7 12 21 12 21z"/></svg>
        <span id="likes">{{LIKES}}</span>
      </div>

      <div class="stats-right" id="shareBtn">Share</div>
    </div>

    <div class="blog-content">
      <h2 id="mainTitle">üê∂ ‡§≠‡§æ‡§≠‡•Ä ‡§ï‡•Ä ‡§Æ‡•ã‡§ü‡•Ä ‡§ó‡§æ‡§Ç‡§° ‡§°‡•â‡§ó‡•Ä ‡§∏‡•ç‡§ü‡§æ‡§á‡§≤ ‡§Æ‡•á‡§Ç ‡§†‡•ã‡§ï‡•Ä üòà</h2>
    </div>

    <div class="suggestions-header">More Viral Videos üî•</div>
    <div class="video-suggestions-list" id="videoSuggestionsList"></div>
  </div>

  <div class="footer-ad-320x50">
    <div class="footer-ad-inner" id="footerAdInner"></div>
  </div>

  <div class="social-bar-wrap" id="socialBarWrap"></div>

  <script>
    let VIDEOID = '79e24c7bdef5453ba3bd500ed180a21b';
    const APIBASE = '{{API_BASE}}';
    const ALLVIDEOS = [{"title": "\ud83d\udebf \u092c\u0939\u0928 \u092d\u093e\u0908 \u0915\u093e \u092c\u093e\u0925\u0930\u0942\u092e \u0938\u0947\u0915\u094d\u0938 \u0915\u0948\u092e \u2764\ufe0f\u200d\ud83d\udd25", "creator": "Content Creator", "video_url": "https://pub-a3ad4cec48664940879fc5dd37a07293.r2.dev/videos/00f6e30dbcc24cba83d8243cc51fb91b.mp4", "thumburl": "https://pub-a3ad4cec48664940879fc5dd37a07293.r2.dev/thumbs/00f6e30dbcc24cba83d8243cc51fb91b.jpg", "video_id": "00f6e30dbcc24cba83d8243cc51fb91b", "time_ago": "just now", "description": "", "player_page_url": "https://clipfy.store/v/00f6e30dbcc24cba83d8243cc51fb91b.html", "player_page_safe_url": "https://clipfy.store/v/00f6e30dbcc24cba83d8243cc51fb91b_safe.html", "thumburl_blur": "https://pub-a3ad4cec48664940879fc5dd37a07293.r2.dev/thumbs/00f6e30dbcc24cba83d8243cc51fb91b_blur.jpg"}];
    try{
      if(!Array.isArray(ALLVIDEOS)){
        console.error('ALLVIDEOS payload is not an array ‚Äî check server template substitution:', ALLVIDEOS);
      } else {
        ALLVIDEOS.sort(() => Math.random() - 0.5);
      }
    }catch(e){
      console.error('Error preparing ALLVIDEOS:', e, ALLVIDEOS);
    }

    const INITIALDATA = {
      title: 'üê∂ ‡§≠‡§æ‡§≠‡•Ä ‡§ï‡•Ä ‡§Æ‡•ã‡§ü‡•Ä ‡§ó‡§æ‡§Ç‡§° ‡§°‡•â‡§ó‡•Ä ‡§∏‡•ç‡§ü‡§æ‡§á‡§≤ ‡§Æ‡•á‡§Ç ‡§†‡•ã‡§ï‡•Ä üòà',
      thumb: 'https://pub-a3ad4cec48664940879fc5dd37a07293.r2.dev/thumbs/79e24c7bdef5453ba3bd500ed180a21b_blur.jpg',
      description: ''
    };

    const player = document.getElementById('player');
    const likesEl = document.getElementById('likes');
    const viewsEl = document.getElementById('views');
    const timeAgoEl = document.getElementById('timeAgo');
    const mainTitleEl = document.getElementById('mainTitle');
    const creatorNameEl = document.getElementById('creatorName');
    const videoSuggestionsList = document.getElementById('videoSuggestionsList');
    const shareBtn = document.getElementById('shareBtn');
    const topThinAdInner = document.getElementById('topThinAdInner');
    const footerAdInner = document.getElementById('footerAdInner');
    const floatingAd320 = document.getElementById('floatingAd320x50');
    const socialBarWrap = document.getElementById('socialBarWrap');

    let viewCounted = false;
    player.addEventListener('play', () => {
      if(viewCounted) return;
      viewCounted = true;
      try{
        fetch(APIBASE + 'hit', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({videoid:VIDEOID,type:'view'})
        });
      }catch(e){}
    });

    shareBtn.onclick = () => {
      const mt = document.querySelector('meta[name="twitter:title"]');
      const shareTitle = (mt && mt.getAttribute('content')) || document.title;
      if(navigator.share){
        navigator.share({title:shareTitle,url:location.href}).catch(()=>{});
      }else{
        navigator.clipboard?.writeText(location.href)
          .then(()=>alert('Link Copied!'))
          .catch(()=>alert(location.href));
      }
    };

    function injectBannerAd(opts){
      const {key, width, height, container} = opts;
      if(!container) return;
      const marker = 'data-at-key-' + key + '-' + width + 'x' + height;
      if(container.getAttribute(marker)) return;
      container.setAttribute(marker,'1');

      try {
        // Create wrapper div
        const wrapper = document.createElement('div');
        wrapper.style.width = '100%';
        wrapper.style.height = '100%';
        container.innerHTML = "";
        container.appendChild(wrapper);

        // Create inline config script
        const inline = document.createElement('script');
        inline.type = 'text/javascript';
        inline.text = `
          window.atOptions = {
            'key':'${key}',
            'format':'iframe',
            'height':${height},
            'width':${width},
            'params':{}
          };
        `;
        wrapper.appendChild(inline);

        // Create ad invoke script with error handling
        const s = document.createElement('script');
        s.type = 'text/javascript';
        // prefer explicit https to avoid mixed-content issues
        s.src = 'https://www.highperformanceformat.com/' + key + '/invoke.js';
        s.async = true;
        s.onload = function(){ console.info('Ad script loaded:', key, width+'x'+height); };
        
        // Fallback if script fails to load
        s.onerror = function() {
          console.warn('Ad script failed to load for key:', key);
          // Retry once after 3 seconds
          setTimeout(() => {
            const retryScript = document.createElement('script');
            retryScript.type = 'text/javascript';
            retryScript.src = 'https://www.highperformanceformat.com/' + key + '/invoke.js';
            retryScript.async = true;
            wrapper.appendChild(retryScript);
          }, 3000);
        };

        wrapper.appendChild(s);
      } catch(e) {
        console.error('Error injecting banner ad:', e);
      }
    }

    function injectSocialBar(container){
      if(!container) return;
      const marker = 'data-social-bar';
      if(container.getAttribute(marker)) return;
      container.setAttribute(marker,'1');

      try {
        const s = document.createElement('script');
        s.type = 'text/javascript';
        s.src = 'https://pl28118636.effectivegatecpm.com/15/a6/05/15a60534651f783c4ee900a1a7101385.js';
        s.async = true;
        
        // Retry on error
        s.onerror = function() {
          console.warn('Social bar script failed to load');
          setTimeout(() => {
            const retryScript = document.createElement('script');
            retryScript.type = 'text/javascript';
            retryScript.src = 'https://pl28118636.effectivegatecpm.com/15/a6/05/15a60534651f783c4ee900a1a7101385.js';
            retryScript.async = true;
            container.appendChild(retryScript);
          }, 2000);
        };
        
        container.appendChild(s);
      } catch(e) {
        console.error('Error injecting social bar:', e);
      }
    }

    function renderVideoSuggestions(videos){
      videoSuggestionsList.innerHTML = '';
      let shown = 0;
      for(const v of videos){
        if(!v || v.videoid === VIDEOID) continue;

        // üî• FIX: Skip safe links in recommendations
        if(v.videoid && v.videoid.includes('_safe')) continue;

        if(shown > 0 && shown % 2 === 0){
          const adSlot = document.createElement('div');
          adSlot.className = 'suggested-ad-slot';
          const inner = document.createElement('div');
          inner.style.width = '300px';
          inner.style.height = '250px';
          inner.style.maxWidth = '95%';
          adSlot.appendChild(inner);
          videoSuggestionsList.appendChild(adSlot);
          injectBannerAd({
            key:'e8550078b37b6bf29c9b54eed61806f7',
            width:300,
            height:250,
            container:inner
          });
        }

        const item = document.createElement('div');
        item.className = 'suggestion-item';
        item.dataset.videoId = v.videoid;
        item.innerHTML = `
          <div class="suggestion-thumbnail">
            <img src="${escapeHtml(v.thumburl)}" alt="${escapeHtml(v.title)}" loading="lazy">
          </div>
          <div class="suggestion-details">
            <div class="suggestion-title">${escapeHtml(v.title)}</div>
            <div class="suggestion-creator">${escapeHtml(v.creator)}</div>
          </div>
        `;
        // üî• FIX: Use direct function call instead of href navigation
        item.addEventListener('click', e => {
          e.preventDefault();
          e.stopPropagation();
          playSuggestedVideo(v);
          return false;
        });
        videoSuggestionsList.appendChild(item);
        shown++;
      }
    }

    function playSuggestedVideo(v){
      if(!v || !v.videourl) return;

      // Update video source and play
      const src = player.querySelector('source');
      src.src = v.videourl;
      player.load();
      player.play().catch(()=>{});
      viewCounted = false;

      // Update page content
      VIDEOID = v.videoid;
      mainTitleEl.innerText = v.title || '';
      timeAgoEl.innerText = v.timeago || '';
      creatorNameEl.innerText = v.creator || 'Clipfy Videos';
      likesEl.innerText = (v.likes != null ? v.likes : 0);
      viewsEl.innerText = (v.views != null ? v.views : 0);

      // Update meta tags
      safeUpdateMetaTags({
        title: v.title,
        document_title: v.title ? (v.title + ' | Clipfy Player') : 'Clipfy Player',
        description: v.description,
        image: v.thumburl || v.thumb || INITIALDATA.thumb,
        playerpage: 'v/' + v.videoid + '.html',
        stream: v.videourl
      });

      // üî• FIX: Always use normal video ID for URL (remove _safe suffix)
      const normalVideoId = v.videoid.replace('_safe', '');
      const newPath = 'v/' + normalVideoId + '.html';
      const stateObj = Object.assign({}, v, {videoid: normalVideoId});

      try{
        const prevPath = location.pathname;
        if(prevPath !== newPath){
          history.pushState(stateObj, v.title, newPath);
        }else{
          history.replaceState(stateObj, v.title, newPath);
        }
      }catch(e){}

      // Re-render suggestions
      renderVideoSuggestions(ALLVIDEOS);
      
      // Scroll to top smoothly
      window.scrollTo({top:0,behavior:'smooth'});
    }

    window.onpopstate = ev => {
      if(!ev.state || !ev.state.videoid) return;
      const s = ev.state;
      const v = s.videourl ? s : ALLVIDEOS.find(x => x.videoid === s.videoid);
      if(!v) return;

      const src = player.querySelector('source');
      src.src = v.videourl;
      player.load();
      player.play().catch(()=>{});
      viewCounted = false;

      VIDEOID = v.videoid;
      mainTitleEl.innerText = v.title || '';
      timeAgoEl.innerText = v.timeago || '';
      creatorNameEl.innerText = v.creator || 'Clipfy Videos';
      likesEl.innerText = (v.likes != null ? v.likes : 0);
      viewsEl.innerText = (v.views != null ? v.views : 0);

      safeUpdateMetaTags({
        title: v.title,
        document_title: v.title ? (v.title + ' | Clipfy Player') : 'Clipfy Player',
        description: v.description,
        image: v.thumburl || v.thumb || INITIALDATA.thumb,
        playerpage: 'v/' + v.videoid + '.html',
        stream: v.videourl
      });

      renderVideoSuggestions(ALLVIDEOS);
      window.scrollTo({top:0,behavior:'smooth'});
    };

    function safeUpdateMetaTags(o){
      try{
        setOrCreateMeta('twitter:title', o.title);
        setOrCreateMeta('twitter:description', o.description);
        setOrCreateMeta('twitter:image', o.image);
        setOrCreateMeta('og:image', o.image);
        setOrCreateMeta('twitter:player', o.playerpage);
        setOrCreateMeta('twitter:player:stream', o.stream);
        document.title = o.document_title || document.title;
      }catch(e){}
    }
    function setOrCreateMeta(nameOrProp, value){
      if(!value) return;
      const isOg = nameOrProp.startsWith('og');
      const sel = isOg ? `meta[property="${nameOrProp}"]` : `meta[name="${nameOrProp}"]`;
      let el = document.querySelector(sel);
      if(!el){
        el = document.createElement('meta');
        if(isOg) el.setAttribute('property', nameOrProp);
        else el.setAttribute('name', nameOrProp);
        document.head.appendChild(el);
      }
      el.setAttribute('content', value);
    }
    function escapeHtml(str){
      if(!str) return '';
      return String(str)
        .replace(/&/g,'&amp;')
        .replace(/</g,'&lt;')
        .replace(/>/g,'&gt;')
        .replace(/"/g,'&quot;')
        .replace(/'/g,'&#39;');
    }

    document.addEventListener('DOMContentLoaded', () => {
      renderVideoSuggestions(ALLVIDEOS);

      // Inject ads with delays to ensure proper loading
      setTimeout(() => {
        injectBannerAd({ key:'b40d9ebf8b9bb68f80451819ab41596e', width:728, height:90, container:topThinAdInner });
      }, 500);

      setTimeout(() => {
        injectBannerAd({ key:'b43458b980a14fc9fc68555f58ae039f', width:320, height:50, container:footerAdInner });
      }, 1000);

      setTimeout(() => {
        injectBannerAd({ key:'b43458b980a14fc9fc68555f58ae039f', width:320, height:50, container:floatingAd320 });
      }, 1500);

      setTimeout(() => {
        injectSocialBar(socialBarWrap);
      }, 2000);

      try{
        const stateObj = {
          videoid: VIDEOID,
          title: INITIALDATA.title,
          videourl: player.querySelector('source').src,
          timeago: 'just now',
          likes: likesEl.innerText || '0',
          views: viewsEl.innerText || '0',
          thumb: INITIALDATA.thumb
        };
        history.replaceState(stateObj, INITIALDATA.title, location.pathname);
      }catch(e){}
    });
      
  // ‚ö° 12-HOUR POP-UNDER SYSTEM (Adsterra Safe)
  (function(){
    const POP_KEY = 'clipfy_pop_ts';
    const now = Date.now();
    const limit = 12 * 60 * 60 * 1000; // 12 hours
    const lastShown = localStorage.getItem(POP_KEY);
    
    // Agar 12 ghante nahi hue ‚Üí pop skip
    if(lastShown && (now - lastShown) < limit) {
      console.log('‚ö° Popunder skipped (12-hour rule)');
      return;
    }
    
    // 15 seconds delay after page load
    setTimeout(() => {
      console.log('üî• Popunder triggered after 15 sec');
      localStorage.setItem(POP_KEY, now);
      
      // Insert Adsterra pop script
      let s = document.createElement('script');
      s.src = 'https://pl28118221.effectivegatecpm.com/ca/e0/e6/cae0e6616497151a47e216bf81ebf050.js';
      s.async = true;
      document.body.appendChild(s);
    }, 15000); // 15 seconds delay
  })();
  </script>
</body>
</html>
