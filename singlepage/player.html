<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Clipfy Player</title>

<!-- META (auto-updated by JS) -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="">
<meta property="og:image" content="">

<meta property="og:image:width" content="1280">
<meta property="og:image:height" content="720">

<meta name="twitter:player" content="">
<meta name="twitter:player:width" content="720">
<meta name="twitter:player:height" content="405">
<meta name="twitter:player:stream" content="">
<meta name="twitter:player:stream:content_type" content="video/mp4">

<style>
body{
  background:#0f141a;color:#fff;margin:0;font-family:Arial;
}

/* ---- VIDEO SECTION ---- */
.video-box{
  width:100%;height:40vh;position:fixed;top:0;left:0;
  background:#000;z-index:9999;display:flex;justify-content:center;
}
.video-box video{
  width:100%;height:100%;object-fit:contain;
}

/* ---- CONTENT ---- */
.content-wrapper{
  padding-top:40vh;
}

/* No empty space problem */
.top-thin-ad{
  background:#1a2430;padding:6px 0;border-bottom:1px solid #222;
  text-align:center;
}
.top-thin-ad-inner{
  width:728px;height:90px;max-width:95%;margin:0 auto;
}

/* ---- POST / USER SECTION ---- */
.post{
  padding:8px 14px;display:flex;gap:10px;border-bottom:1px solid #222;
}
.dp{
  width:42px;height:42px;border-radius:50%;background:#555;
}

/* ---- STATS SECTION ---- */
.stats{
  display:flex;gap:14px;padding:8px 14px;border-bottom:1px solid #222;
  font-size:14px;color:#ccc;
}
.stat-item{
  display:flex;align-items:center;gap:6px;
}

/* ---- TITLE + INLINE AD ---- */
.blog-content{
  padding:12px 14px;font-size:15px;line-height:1.4;
}
#mainTitle{
  font-size:18px;font-weight:600;margin-bottom:10px;
}

.inline-ad-slot{
  display:flex;justify-content:center;padding:10px 0;min-height:250px;
}

/* ---- SUGGESTIONS ---- */
.suggestions-header{
  padding:10px 14px;font-size:16px;font-weight:700;border-top:1px solid #222;
}

.suggestion-item{
  padding:10px 14px;border-bottom:1px solid #1a2430;cursor:pointer;
}
.suggestion-thumbnail{
  width:100%;aspect-ratio:16/9;overflow:hidden;border-radius:6px;
}
.suggestion-thumbnail img{
  width:100%;height:100%;object-fit:cover;
}

/* ---- FOOTER AD ---- */
.footer-ad-320x50{
  position:fixed;bottom:0;width:100%;background:#000;
  display:flex;justify-content:center;padding:4px 0;z-index:10000;
}
.footer-ad-inner{
  width:320px;height:50px;
}
</style>
</head>

<body>

<div class="video-box">
  <video id="player" playsinline controls autoplay muted>
    <source id="videoSource" src="">
  </video>
</div>

<div class="content-wrapper">

  <div class="top-thin-ad">
    <div class="top-thin-ad-inner" id="topAd"></div>
  </div>

  <div class="post">
    <div class="dp" id="creatorDp"></div>
    <div>
      <div id="creatorName">Clipfy Videos</div>
      <div id="timeAgo"></div>
    </div>
  </div>

  <div class="stats">
    <div class="stat-item"><span id="views">0</span></div>
    <div class="stat-item"><span id="likes">0</span></div>
  </div>

  <div class="blog-content">
    <h2 id="mainTitle"></h2>

    <div class="inline-ad-slot">
      <div id="inlineAd" style="width:300px;height:250px;"></div>
    </div>
  </div>

  <div class="suggestions-header">More Viral Videos ðŸ”¥</div>
  <div id="suggestions"></div>

</div>

<div class="footer-ad-320x50">
  <div class="footer-ad-inner" id="footerAd"></div>
</div>

<!-- FINAL FIXED JS -->
<script>
const DATA_URL = "https://pub-a3ad4cec48664940879fc5dd37a07293.r2.dev/singlepage/index.json";

const params = new URLSearchParams(location.search);
let VIDEOID = params.get("v");
const safeMode = params.get("safe") === "1";
const twitterMode = params.get("t") === "1";

let videos = {};

const player = document.getElementById("player");
const videoSource = document.getElementById("videoSource");
const mainTitle = document.getElementById("mainTitle");
const creatorName = document.getElementById("creatorName");
const timeAgo = document.getElementById("timeAgo");
const viewsEl = document.getElementById("views");
const likesEl = document.getElementById("likes");
const suggestions = document.getElementById("suggestions");

async function loadData() {
    const r = await fetch(DATA_URL, { cache: "no-store" });
    const raw = await r.json();

    raw.forEach(v => {
        videos[v.videoid] = {
            id: v.videoid,
            title: v.title,
            description: v.description || "",
            creator: v.creator,
            timeago: v.timeago,
            views: v.views,
            likes: v.likes,
            videourl: v.videourl,
            thumb: v.thumb,
            safe_thumb: v.safe_thumb || v.thumb,
        };
    });

    if (!VIDEOID || !videos[VIDEOID]) {
        VIDEOID = Object.keys(videos)[0];
    }

    loadVideo(VIDEOID, false);
    renderSuggestions();
}

function loadVideo(id, push = true) {
    const v = videos[id];
    if (!v) return;

    VIDEOID = id;

    videoSource.src = v.videourl;
    player.load();
    player.play().catch(()=>{});

    // UI
    mainTitle.textContent = v.title;
    creatorName.textContent = v.creator;
    timeAgo.textContent = v.timeago;
    viewsEl.textContent = v.views;
    likesEl.textContent = v.likes;

    // Only META uses safe thumbnail
    const img = safeMode ? v.safe_thumb : v.thumb;

    setMeta("twitter:title", v.title);
    setMeta("twitter:image", img);
    setMeta("og:image", img);
    setMeta("twitter:player:stream", v.videourl);

    document.title = v.title + " | Clipfy";

    if (push) {
        history.pushState({}, "",
            `player.html?v=${id}` +
            (twitterMode ? "&t=1" : "") +
            (safeMode ? "&safe=1" : "")
        );
    }
}

function renderSuggestions() {
    suggestions.innerHTML = "";

    Object.keys(videos).forEach(id => {
        if (id === VIDEOID) return;
        const v = videos[id];

        const d = document.createElement("div");
        d.className = "suggestion-item";

        d.innerHTML = `
            <div class="suggestion-thumbnail">
                <img src="${v.thumb}">
            </div>
            <div class="suggestion-title">${v.title}</div>
        `;
        d.onclick = () => {
            loadVideo(id, true);
            window.scrollTo({ top: 0, behavior: "smooth" });
        };
        suggestions.appendChild(d);
    });
}

function setMeta(name, value) {
    let m = document.querySelector(`meta[name="${name}"]`) ||
            document.querySelector(`meta[property="${name}"]`);
    if (!m) {
        m = document.createElement("meta");
        if (name.startsWith("og")) m.setAttribute("property", name);
        else m.setAttribute("name", name);
        document.head.appendChild(m);
    }
    m.setAttribute("content", value);
}

window.onpopstate = () => loadVideo(VIDEOID, false);

loadData();
</script>

</body>
</html>
