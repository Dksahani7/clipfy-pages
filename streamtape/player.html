<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Clipfy Player</title>

<style>
:root{
  --bg:#0f141a;
  --card:#12182e;
  --text:#fff;
  --muted:#8b93b0;
  --accent:#ff2f5b;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,-apple-system,Arial,sans-serif;
  overflow-x:hidden
}
header{
  position:sticky;top:0;z-index:1000;
  background:rgba(15,20,26,.95);
  backdrop-filter:blur(10px);
  border-bottom:1px solid rgba(255,255,255,.05)
}
.nav{
  max-width:1200px;
  margin:auto;
  padding:10px 20px;
  font-size:22px;
  font-weight:800
}
.nav span{color:var(--accent)}

.video-container{
  position:sticky;
  top:60px;
  background:#000;
  z-index:900
}
.video-box{
  width:100%;
  aspect-ratio:16/9;
  max-height:60vh;
  background:#000
}
.video-box iframe{
  width:100%;
  height:100%;
  border:0
}

.content{
  max-width:1200px;
  margin:auto;
  padding:0 20px
}

#adTop{margin:20px auto;max-width:728px;min-height:90px;text-align:center}
#adNative{margin:30px auto}

h1{font-size:22px;margin:15px 0}
.meta{color:var(--muted);font-size:14px;margin-bottom:10px}

#suggestions{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
  gap:16px;
  margin-top:20px
}
.item{
  background:var(--card);
  border-radius:10px;
  overflow:hidden;
  cursor:pointer
}
.item img{
  width:100%;
  aspect-ratio:16/9;
  object-fit:cover
}
.item div{
  padding:10px;
  font-size:14px;
  font-weight:600
}

footer{
  margin-top:40px;
  padding:20px;
  text-align:center;
  font-size:13px;
  color:var(--muted);
  border-top:1px solid rgba(255,255,255,.05)
}

@media(max-width:768px){
  #adTop{display:none}
  .video-box{aspect-ratio:16/10}
}
</style>
</head>

<body>

<header>
  <div class="nav">▶ <span>clipfy.store</span></div>
</header>

<div class="video-container">
  <div class="video-box">
    <iframe
      id="player"
      allow="autoplay; fullscreen; encrypted-media; picture-in-picture"
      allowfullscreen
      referrerpolicy="no-referrer">
    </iframe>
  </div>
</div>

<div id="adTop"></div>

<div class="content">
  <h1 id="title">Loading…</h1>
  <div class="meta" id="meta"></div>

  <div id="suggestions"></div>

  <div id="adNative"></div>
</div>

<footer>© 2024 Clipfy.store</footer>

<script>
/* ===== CONFIG ===== */
const DATA_URL =
"https://pub-a3ad4cec48664940879fc5dd37a07293.r2.dev/streamtape/index.json";
const BYSE_BASE = "https://bysefujedu.com/e/";

/* ===== ELEMENTS ===== */
const iframe = document.getElementById("player");
const titleEl = document.getElementById("title");
const metaEl = document.getElementById("meta");
const sug = document.getElementById("suggestions");
const adTop = document.getElementById("adTop");
const adNative = document.getElementById("adNative");

let videos = {};
let playCount = 0;

/* ===== HELPERS ===== */
function qs(){
  return new URLSearchParams(location.search).get("v");
}
function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

/* ===== ADS ===== */
function loadTopAd(){
  adTop.innerHTML="";
  const s1=document.createElement("script");
  s1.innerHTML=`atOptions={'key':'b40d9ebf8b9bb68f80451819ab41596e','format':'iframe','height':90,'width':728};`;
  const s2=document.createElement("script");
  s2.src="https://stinkymildred.com/b40d9ebf8b9bb68f80451819ab41596e/invoke.js";
  adTop.append(s1,s2);
}
function loadNative(){
  adNative.innerHTML="";
  const s=document.createElement("script");
  s.src="https://stinkymildred.com/2095e01c6ff1562d16722ad413d6a9ba/invoke.js";
  s.async=true;
  const d=document.createElement("div");
  d.id="container-2095e01c6ff1562d16722ad413d6a9ba";
  adNative.append(s,d);
}

/* ===== VIDEO ===== */
function playVideo(id){
  const v=videos[id];
  if(!v) return;

  iframe.src = BYSE_BASE + v.streamtape_id;

  titleEl.textContent = v.title || "Untitled";
  metaEl.textContent =
    (v.creator||"Clipfy") + " • " +
    ((v.views||Math.floor(Math.random()*50000)).toLocaleString())+" views";

  history.replaceState(null,"","?v="+id);

  playCount++;
  if(playCount % 3 === 0){
    const p=document.createElement("script");
    p.src="https://stinkymildred.com/ca/e0/e6/cae0e6616497151a47e216bf81ebf050.js";
    document.body.appendChild(p);
  }

  loadTopAd();
  loadNative();
  renderSuggestions(id);
}

function renderSuggestions(current){
  sug.innerHTML="";
  let ids=shuffle(Object.keys(videos).filter(i=>i!==current));
  ids.forEach(id=>{
    const v=videos[id];
    const d=document.createElement("div");
    d.className="item";
    d.innerHTML=`
      <img src="${v.thumb||''}" onerror="this.src='https://via.placeholder.com/640x360'">
      <div>${v.title||"Untitled"}</div>
    `;
    d.onclick=()=>{ playVideo(id); scrollTo({top:0,behavior:"smooth"}); };
    sug.appendChild(d);
  });
}

/* ===== INIT ===== */
fetch(DATA_URL,{cache:"no-store"})
.then(r=>r.json())
.then(list=>{
  list.forEach(v=>videos[v.videoid]=v);
  playVideo(qs() || Object.keys(videos)[0]);
});
</script>

</body>
</html>
