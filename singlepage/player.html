<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Clipfy Player</title>

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="">
<meta property="og:image" content="">
<meta property="og:image:width" content="1280">
<meta property="og:image:height" content="720">
<meta name="twitter:player" content="">
<meta name="twitter:player:width" content="720">
<meta name="twitter:player:height" content="405">
<meta name="twitter:player:stream" content="">
<meta name="twitter:player:stream:content_type" content="video/mp4">

<style>
body{
	background:#0f141a;color:#fff;margin:0;font-family:Arial;
}

/* VIDEO */
.video-box{
	width:100%;height:40vh;position:fixed;top:0;left:0;
	background:#000;z-index:9999;display:flex;justify-content:center;
}
.video-box video{
	width:100%;height:100%;object-fit:contain;
}

/* CONTENT */
.content-wrapper{ padding-top:40vh; }

/* TOP AD */
.top-thin-ad{
	background:#1a2430;padding:3px 0;border-bottom:1px solid #222;text-align:center;
}
.top-thin-ad-inner{ width:728px;max-width:95%;margin:0 auto; }

/* POST */
.post{
	padding:8px 14px;display:flex;gap:10px;border-bottom:1px solid #222;
}
.dp{
	width:42px;height:42px;border-radius:50%;background:#555;background-size:cover;background-position:center;
}

/* STATS */
.stats{
	display:flex;gap:14px;padding:8px 14px;border-bottom:1px solid #222;
	font-size:14px;color:#ccc;
}
.stat-item{ display:flex;align-items:center;gap:6px; }

/* TITLE */
.blog-content{ padding:12px 14px;font-size:15px;line-height:1.4; }
#mainTitle{ font-size:18px;font-weight:600;margin-bottom:10px; }

/* SUGGESTIONS */
.suggestions-header{
	padding:10px 14px;font-size:16px;font-weight:700;border-top:1px solid #222;
}
.suggestion-item{
	padding:10px 14px;border-bottom:1px solid #1a2430;cursor:pointer;display:flex;gap:10px;align-items:center;
}
.suggestion-thumbnail{
	width:40%;aspect-ratio:16/9;overflow:hidden;border-radius:6px;flex:0 0 40%;
}
.suggestion-thumbnail img{
	width:100%;height:100%;object-fit:cover;
}
.suggestion-title{ flex:1;font-size:14px; }

/* INLINE AD */
.inline-ad{
	width:100%;
	display:flex;
	justify-content:center;
	margin:12px 0;
}

/* FOOTER AD */
.footer-ad-320x50{
	position:fixed;
	bottom:0;
	width:100%;
	background:#000;
	display:flex;
	justify-content:center;
	z-index:10000;
}
.footer-ad-inner{
	width:320px;
	min-height:0px;
}
.hidden{ display:none !important; }

@media (min-width: 768px) {
    .video-box { height: 500px; }
    .content-wrapper { padding-top: 500px; }
}
</style>
</head>

<body>

<!-- VIDEO -->
<div class="video-box">
	<video id="player" playsinline controls controlsList="nodownload nofullscreen" autoplay muted>
		<source id="videoSource" src="">
	</video>
</div>

<div class="content-wrapper">

	<!-- TOP AD (Adsterra 728x90) -->
	<div class="top-thin-ad">
		<div class="top-thin-ad-inner" id="topAd">
			<!-- Adsterra TOP (728x90) -->
<script type="text/javascript">
  atOptions = {
  	'key' : 'b40d9ebf8b9bb68f80451819ab41596e',
  	'format' : 'iframe',
  	'height' : 90,
  	'width' : 728,
  	'params' : {}
  };
</script>
<script type="text/javascript" src="//stinkymildred.com/b40d9ebf8b9bb68f80451819ab41596e/invoke.js"></script>
		</div>
	</div>

	<!-- POST / CREATOR -->
	<div class="post">
		<div class="dp" id="creatorDp"></div>
		<div style="flex:1">
			<div id="creatorName" style="font-weight:600"></div>
			<div id="timeAgo" style="font-size:13px;color:#aaa"></div>
		</div>
	</div>

	<!-- STATS -->
	<div class="stats">
		<div class="stat-item"><span id="views">0</span></div>
		<div class="stat-item"><span id="likes">0</span></div>
	</div>

	<!-- TITLE -->
	<div class="blog-content">
		<h2 id="mainTitle"></h2>
	</div>

	<!-- SUGGESTIONS HEADER -->
	<div class="suggestions-header">More Viral Videos ðŸ”¥</div>
	<div id="suggestions"></div>

</div>

<!-- FOOTER AD (320x50) - auto-hide if not loaded -->
<div class="footer-ad-320x50 hidden" id="footerBox">
	<div class="footer-ad-inner" id="footerAd">
		<!-- Adsterra FOOTER 320x50 -->
<script type="text/javascript">
  atOptions = {
  	'key' : 'b43458b980a14fc9fc68555f58ae039f',
  	'format' : 'iframe',
  	'height' : 50,
  	'width' : 320,
  	'params' : {}
  };
</script>
<script type="text/javascript" src="//stinkymildred.com/b43458b980a14fc9fc68555f58ae039f/invoke.js"></script>
	</div>
</div>

<script>
// footer auto-show when iframe present
setTimeout(() => {
	let iframe = document.querySelector('#footerAd iframe');
	if (iframe && iframe.src) {
		document.getElementById("footerBox").classList.remove("hidden");
	} else {
		// Some ad scripts append later â€” listen for DOM changes briefly
		const obs = new MutationObserver((m) => {
			if (document.querySelector('#footerAd iframe')) {
				document.getElementById("footerBox").classList.remove("hidden");
				obs.disconnect();
			}
		});
		obs.observe(document.getElementById('footerAd'), { childList: true, subtree: true });
	}
}, 1500);
</script>

<script>
/* ========== DATA + PLAYER + SUGGESTIONS ========== */
const DATA_URL = "https://pub-a3ad4cec48664940879fc5dd37a07293.r2.dev/singlepage/index.json";

const player = document.getElementById("player");
const videoSource = document.getElementById("videoSource");
const mainTitle = document.getElementById("mainTitle");
const creatorNameEl = document.getElementById("creatorName");
const timeAgoEl = document.getElementById("timeAgo");
const viewsEl = document.getElementById("views");
const likesEl = document.getElementById("likes");
const creatorDp = document.getElementById("creatorDp");
const suggestions = document.getElementById("suggestions");

let VIDEOID = null;
let videos = {}; // map videoid => video object

function getUrlParams() {
    const params = new URLSearchParams(location.search);
    return {
        v: params.get("v"),
        safeMode: params.get("safe") === "1",
        twitterMode: params.get("t") === "1"
    };
}

function setMeta(name, value) {
	let m = document.querySelector(`meta[name="${name}"]`) ||
			document.querySelector(`meta[property="${name}"]`);
	if (!m) {
		m = document.createElement("meta");
		if (name.startsWith("og")) m.setAttribute("property", name);
		else m.setAttribute("name", name);
		document.head.appendChild(m);
	}
	m.setAttribute("content", value);
}

async function loadData() {
	try {
		const r = await fetch(DATA_URL, { cache: "no-store" });
		if (!r.ok) throw new Error("network");
		const raw = await r.json();

		raw.forEach(v => {
			// normalize
			videos[v.videoid] = {
				videoid: v.videoid,
				title: v.title || "Untitled Video",
				creator: v.creator || "Clipfy",
				creator_dp: v.creator_dp || "",
				timeago: v.timeago || "Just now",
				views: v.views || "0 Views",
				likes: v.likes || "0 Likes",
				videourl: v.videourl,
				thumb: v.thumb,
				safe_thumb: v.safe_thumb || v.thumb
			};
		});

		const { v: vidParam, safeMode } = getUrlParams();
		let idToLoad = vidParam && videos[vidParam] ? vidParam : Object.keys(videos)[0];
		if (!idToLoad) {
			mainTitle.textContent = "No videos available";
			return;
		}

		loadVideo(idToLoad, true);
		renderSuggestions();

	} catch (err) {
		console.error("loadData error", err);
		mainTitle.textContent = "Error loading video.";
		creatorNameEl.textContent = "Clipfy";
	}
}

function loadVideo(id, push = true) {
	const v = videos[id];
	if (!v) return;

	VIDEOID = id;
	const { safeMode, twitterMode } = getUrlParams();

	// set video source
	videoSource.src = v.videourl;
	player.load();
	player.play().catch(e => {
		// autoplay blocked â€” that's fine
	});

	// UI
	mainTitle.textContent = v.title;
	creatorNameEl.textContent = v.creator;
	timeAgoEl.textContent = v.timeago;
	viewsEl.textContent = v.views;
	likesEl.textContent = v.likes;

	// creator dp
	if (v.creator_dp) {
		creatorDp.style.backgroundImage = `url(${v.creator_dp})`;
	} else {
		creatorDp.style.backgroundImage = '';
	}

	// meta tags (safe mode uses safe_thumb)
	const img = safeMode ? v.safe_thumb : v.thumb;
	setMeta("twitter:title", v.title);
	setMeta("twitter:description", v.title);
	setMeta("twitter:image", img);
	setMeta("og:image", img);
	setMeta("twitter:player:stream", v.videourl);

	document.title = v.title + " | Clipfy";

	// pushState
	if (push) {
		const params = new URLSearchParams();
		params.set("v", id);
		if (twitterMode) params.set("t", 1);
		if (safeMode) params.set("safe", 1);
		history.pushState({}, "", `player.html?${params.toString()}`);
	}
}

/* render suggestions with inline ad every 2 videos */
function renderSuggestions() {
	suggestions.innerHTML = "";
	let count = 0;

	Object.keys(videos).forEach(id => {
		if (id === VIDEOID) return;
		const v = videos[id];
		count++;

		// suggestion item
		const d = document.createElement("div");
		d.className = "suggestion-item";
		d.innerHTML = `
			<div class="suggestion-thumbnail"><img src="${v.thumb}" alt=""></div>
			<div class="suggestion-title"><div class="suggestion-title-text">${escapeHtml(v.title)}</div></div>
		`;
		d.onclick = () => { loadVideo(id, true); window.scrollTo({ top: 0, behavior: "smooth" }); };
		suggestions.appendChild(d);

		// insert inline ad after every 2 videos
		if (count % 2 === 0) {
			const adWrapper = document.createElement("div");
			adWrapper.className = "inline-ad";

			// Inline Adsterra code (user-provided)
			adWrapper.innerHTML = `
<div id="atContainer-e8550078b37b6bf29c9b54eed61806f7"></div>
<script type="text/javascript">
  if (typeof atAsyncOptions !== 'object') var atAsyncOptions = [];
  atAsyncOptions.push({
    key: 'e8550078b37b6bf29c9b54eed61806f7',
    format: 'js',
    async: true,
    container: 'atContainer-e8550078b37b6bf29c9b54eed61806f7',
    params: {},
  });
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.async = true;
  script.src =
    'http' +
    (location.protocol === 'https:' ? 's' : '') +
    '://stinkymildred.com/e8550078b37b6bf29c9b54eed61806f7/invoke.js';
  document.getElementsByTagName('head')[0].appendChild(script);
</script>
			`;
			suggestions.appendChild(adWrapper);
		}
	});
}

/* simple helper to prevent basic HTML injection via titles */
function escapeHtml(str) {
	if(!str) return '';
	return str.replace(/[&<>"'\/]/g, function (s) {
	  const entityMap = {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;', '/':'&#x2F;'};
	  return entityMap[s];
	});
}

window.onpopstate = () => {
	const { v: newVideoId } = getUrlParams();
	if (newVideoId && videos[newVideoId]) {
		loadVideo(newVideoId, false);
	}
};

loadData();
</script>

<!-- SOCIAL BAR (user provided) -->
<script type="text/javascript" src="//stinkymildred.com/15/a6/05/15a60534651f783c4ee900a1a7101385.js"></script>

<!-- ALL-IN-ONE AD (keeps existing behavior) -->
<script src="https://quge5.com/88/tag.min.js" data-zone="191105" async data-cfasync="false"></script>

</body>
</html>
