<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Clipfy Player</title>

<meta name="twitter:card" content="summary_large_image" /> 
<meta name="twitter:title" content="Clipfy Player" />
<meta name="twitter:description" content="" />

<style>
body{
  background:#0f141a;
  color:#fff;
  font-family:Arial, sans-serif;
  margin:0;
  padding:0;
  overflow-x:hidden;
}

.video-box{
  width:100%;
  height:32vh;
  position:fixed;
  top:0;
  left:0;
  background:#000;
  overflow:hidden;
  z-index:9999;
  display:flex;
  align-items:center;
  justify-content:center;
}
video{
  width:100%;
  height:100%;
  object-fit:contain;
}

.content-wrapper{
  padding-top:32vh;
  min-height:140vh;
}

.post{
  padding:12px;
  display:flex;
  gap:10px;
  align-items:center;
}
.dp{
  width:42px;
  height:42px;
  border-radius:50%;
  background:#555;
}
.stats{
  display:flex;
  gap:15px;
  padding:12px;
  border-bottom:1px solid #222;
  font-size:14px;
  align-items:center;
}
.blog-content{
  padding:20px;
  font-size:17px;
  line-height:1.7;
}

.suggestions-header{
  padding:12px 20px;
  font-size:18px;
  font-weight:700;
  border-top:1px solid #222;
}
.video-suggestions-list{
  background:transparent;
  overflow:visible;
}
.suggestion-item{
  display:flex;
  gap:12px;
  width:100%;
  padding:14px 20px;
  cursor:pointer;
  border-bottom:1px solid #1a2430;
  transition:background .12s;
}
.suggestion-item:hover{
  background:#0b1216;
}
.suggestion-thumbnail{
  width:150px;
  height:84px;
  min-width:150px;
  border-radius:8px;
  overflow:hidden;
  background:#333;
}
.suggestion-thumbnail img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}
.suggestion-details{
  display:flex;
  flex-direction:column;
  justify-content:center;
  flex:1;
}
.suggestion-title{
  font-weight:600;
  font-size:15px;
  line-height:1.25;
  margin-bottom:6px;
  display:-webkit-box;
  -webkit-line-clamp:2;
  -webkit-box-orient:vertical;
  overflow:hidden;
}
.suggestion-creator{
  font-size:12px;
  color:#aaa;
}

.center{ text-align:center }
.hidden{ display:none !important }
</style>
</head>
<body>

<div class="video-box">
  <video id="player" playsinline controls autoplay muted>
    <source src="" type="video/mp4">
  </video>
</div>

<div class="content-wrapper">

  <!-- Thin Ad Under Video -->
  <div id="thinAd" style="width:100%; height:50px; background:#1a1f26; display:flex; align-items:center; justify-content:center; border-bottom:1px solid #222;">
    <img src="https://via.placeholder.com/320x50?text=Ad" style="max-width:100%; max-height:50px; border-radius:4px;" />
  </div>


  <div class="post">
    <div class="dp" id="creatorDp"></div>
    <div>
      <div style="font-weight:300;" id="creatorName">Clipfy video</div>
      <div class="title" id="timeAgo">just now</div>
    </div>
  </div>

  <div class="stats">
    <div style="display:flex; align-items:center; gap:6px;">
      <span id="likes">0</span>
      <span style="opacity:0.7; font-size:12px;">likes</span>
    </div>

    <div style="display:flex; align-items:center; gap:6px;">
      <span id="views">0</span>
      <span style="opacity:0.7; font-size:12px;">views</span>
    </div>

    <div style="margin-left:auto; cursor:pointer;" id="shareBtn">ðŸ”— Share</div>
  </div>

  <div class="blog-content" style="padding:12px 20px; font-size:17px; line-height:1.4; margin-bottom:6px;">
  <h2 id="mainTitle" style="font-size:20px; font-weight:600; margin:0; padding:0;">Clipfy Player</h2>
</div>

  <div class="suggestions-header">More Viral Videos ðŸ”¥</div>
  <div class="video-suggestions-list" id="videoSuggestionsList"></div>
</div>

<script>
// Minimal cleaned player script (no ads)
let VIDEO_ID = '';
const ALL_VIDEOS = [];
const INITIAL_DATA = { title: 'Clipfy Player', thumb: '' };

/* DOM refs */
const player = document.getElementById('player');
const likesEl = document.getElementById('likes');
const viewsEl = document.getElementById('views');
const timeAgoEl = document.getElementById('timeAgo');
const mainTitleEl = document.getElementById('mainTitle');
const videoSuggestionsList = document.getElementById('videoSuggestionsList');
const shareBtn = document.getElementById('shareBtn');
const creatorNameEl = document.getElementById('creatorName');

let viewCounted = false;
player.addEventListener('play', ()=>{
  if (!viewCounted && VIDEO_ID){
    viewCounted = true;
    // optional: analytics hit
  }
});

shareBtn.onclick = ()=>{
  const shareTitle = document.querySelector('meta[name="twitter:title"]').getAttribute('content') || document.title;
  if (navigator.share){
    navigator.share({ title: shareTitle, url: location.href }).catch(()=>{});
  } else {
    navigator.clipboard?.writeText(location.href).then(()=>alert('Link Copied!')).catch(()=>alert(location.href));
  }
};

function escapeHtml(str){ return String(str).replace(/[&<>\"]/g, s=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' }[s])); }

function renderVideoSuggestions(videos){
  videoSuggestionsList.innerHTML = '';
  let count = 0;
  for (let i=0;i<videos.length;i++){
    const v = videos[i];
    if (!v || v.video_id === VIDEO_ID) continue;

    // Insert ad every 3 items
    if (count > 0 && count % 3 === 0) {
      const adBox = document.createElement('div');
      adBox.style = "width:100%; padding:10px 0; display:flex; justify-content:center;";
      adBox.innerHTML = `<img src="https://via.placeholder.com/320x100?text=Ad" style="width:100%; max-width:350px; border-radius:8px;" />`;
      videoSuggestionsList.appendChild(adBox);
    }

    const item = document.createElement('div');
    item.className = 'suggestion-item';
    item.setAttribute('data-video-id', v.video_id);
    item.innerHTML = `
      <div class="suggestion-thumbnail">
        <img src="${v.thumb_url}" alt="${escapeHtml(v.title)} thumbnail" loading="lazy">
      </div>
      <div class="suggestion-details">
        <div class="suggestion-title">${escapeHtml(v.title)}</div>
        <div class="suggestion-creator">${escapeHtml(v.creator || '')}</div>
      </div>
    `;
    item.addEventListener('click', (e)=>{ e.preventDefault(); playSuggestedVideo(v); });
    videoSuggestionsList.appendChild(item);
    count++;
  }
}

function playSuggestedVideo(videoData){
  if(!videoData || !videoData.video_url) return;
  const sourceEl = player.querySelector('source');
  sourceEl.src = videoData.video_url;
  player.load();
  player.play().catch(()=>{});
  viewCounted = false;
  timeAgoEl.innerText = videoData.time_ago || '';
  mainTitleEl.innerText = videoData.title || '';
  creatorNameEl.innerText = videoData.creator || '';
  likesEl.innerText = (typeof videoData.likes !== 'undefined') ? videoData.likes : (likesEl.innerText || '0');
  viewsEl.innerText = (typeof videoData.views !== 'undefined') ? videoData.views : (viewsEl.innerText || '0');
  document.title = (videoData.title ? (videoData.title + ' | Clipfy Player') : 'Clipfy Player');
  VIDEO_ID = videoData.video_id;
  const newPath = `/v/${videoData.video_id}.html`;
  try{ history.pushState(Object.assign({}, videoData), videoData.title, newPath); }catch(e){}
  renderVideoSuggestions(ALL_VIDEOS);
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

window.onpopstate = function(event){
  if (event.state && event.state.video_id){
    const s = event.state;
    const vidData = (s.video_url ? s : (ALL_VIDEOS.find(x=>x.video_id===s.video_id) || s));
    const sourceEl = player.querySelector('source');
    if (vidData.video_url) sourceEl.src = vidData.video_url;
    player.load();
    player.play().catch(()=>{});
    viewCounted = false;
    timeAgoEl.innerText = vidData.time_ago || '';
    mainTitleEl.innerText = vidData.title || '';
    creatorNameEl.innerText = vidData.creator || '';
    likesEl.innerText = vidData.likes || likesEl.innerText || '0';
    viewsEl.innerText = vidData.views || viewsEl.innerText || '0';
    VIDEO_ID = vidData.video_id;
    renderVideoSuggestions(ALL_VIDEOS);
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }
};

function safeUpdateMetaTags(){ /* noop for cleaned file */ }

// Initialize - plug in server-rendered data if present
document.addEventListener('DOMContentLoaded', ()=>{
  try{ if (window.__CLIPFY_INIT){
      // if templating injected data exists, use it
      const d = window.__CLIPFY_INIT;
      VIDEO_ID = d.video_id || VIDEO_ID;
      const src = d.video_url || '';
      if (src) player.querySelector('source').src = src;
      ALL_VIDEOS.length = 0;
      if (Array.isArray(d.all_videos)) d.all_videos.forEach(x=>ALL_VIDEOS.push(x));
      mainTitleEl.innerText = d.title || mainTitleEl.innerText;
    }
  }catch(e){}
  renderVideoSuggestions(ALL_VIDEOS);
  try{ const stateObj = { video_id: VIDEO_ID, title: INITIAL_DATA.title, video_url: player.querySelector('source').src, time_ago: 'just now', likes: likesEl.innerText || 0, views: viewsEl.innerText || 0, thumb: INITIAL_DATA.thumb }; history.replaceState(stateObj, INITIAL_DATA.title, location.pathname);}catch(e){}
});
</script>
</body>
</html>

