<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Clipfy Admin Panel</title>

<style>
:root{
  --bg:#0f141a;--card:#12182e;--text:#fff;--muted:#8b93b0;
  --accent:#ff2f5b;--success:#10b981;--warning:#f59e0b;
  --danger:#ef4444;--hover:#1a2139;
}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--text);font-family:Arial}

header{background:#0f141a;padding:16px;border-bottom:1px solid #222}
.logo{font-size:22px;font-weight:900;color:var(--accent)}

.container{padding:20px;max-width:1400px;margin:auto}

.btn{padding:8px 14px;border:none;border-radius:8px;cursor:pointer}
.btn-success{background:var(--success);color:#fff}
.btn-danger{background:var(--danger);color:#fff}
.btn-warning{background:var(--warning);color:#000}

table{width:100%;border-collapse:collapse;margin-top:20px}
th,td{padding:12px;border-bottom:1px solid #222;text-align:left}
tr:hover{background:var(--hover)}

.status-live{color:#0f0}
.status-offline{color:#f00}

.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.8);
align-items:center;justify-content:center}
.modal-box{background:#12182e;padding:20px;border-radius:12px;width:400px}
.modal-box input,select{width:100%;padding:10px;margin:8px 0}
</style>
</head>

<body>

<header>
  <div class="logo">ðŸ”§ Clipfy Admin Panel</div>
</header>

<div class="container">
  <button class="btn btn-success" onclick="refresh()">ðŸ”„ Refresh</button>

  <table>
    <thead>
      <tr>
        <th>Thumb</th>
        <th>Title</th>
        <th>ID</th>
        <th>Views</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="tbody">
      <tr><td colspan="6">Loading...</td></tr>
    </tbody>
  </table>
</div>

<!-- EDIT MODAL -->
<div class="modal" id="modal">
  <div class="modal-box">
    <h3>Edit Video</h3>
    <input id="m_title" placeholder="Title">
    <input id="m_views" type="number" placeholder="Views">
    <select id="m_status">
      <option value="live">Live</option>
      <option value="offline">Offline</option>
    </select>
    <button class="btn btn-success" onclick="save()">Save</button>
    <button class="btn btn-danger" onclick="closeModal()">Cancel</button>
  </div>
</div>

<script>
/* ================= CONFIG ================= */
const API = "https://clipfy.store/api";
const ADMIN_TOKEN = "sk_live_a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6";

/* ================= STATE ================= */
let videos = [];
let currentId = null;

/* ================= LOAD ================= */
async function load() {
  const r = await fetch(API + "/videos", {
    headers: { Authorization: ADMIN_TOKEN }
  });
  videos = await r.json();
  render();
}

function render() {
  const tb = document.getElementById("tbody");
  tb.innerHTML = "";
  videos.forEach(v => {
    tb.innerHTML += `
      <tr>
        <td><img src="${v.thumb}" width="80"></td>
        <td>${v.title}</td>
        <td>${v.videoid}</td>
        <td>${v.views||0}</td>
        <td class="${v.offline?'status-offline':'status-live'}">
          ${v.offline?'Offline':'Live'}
        </td>
        <td>
          <button class="btn btn-warning" onclick="edit('${v.videoid}')">Edit</button>
          <button class="btn btn-danger" onclick="del('${v.videoid}')">Delete</button>
        </td>
      </tr>
    `;
  });
}

/* ================= EDIT ================= */
function edit(id){
  const v = videos.find(x=>x.videoid===id);
  currentId = id;
  m_title.value = v.title;
  m_views.value = v.views||0;
  m_status.value = v.offline ? "offline" : "live";
  modal.style.display="flex";
}

function closeModal(){
  modal.style.display="none";
}

async function save(){
  await fetch(API + "/video/update",{
    method:"POST",
    headers:{
      Authorization:ADMIN_TOKEN,
      "Content-Type":"application/json"
    },
    body:JSON.stringify({
      videoid:currentId,
      data:{
        title:m_title.value,
        views:+m_views.value,
        offline:m_status.value==="offline"
      }
    })
  });
  closeModal();
  load();
}

/* ================= DELETE ================= */
async function del(id){
  if(!confirm("Delete video?"))return;
  await fetch(API + "/video/delete",{
    method:"POST",
    headers:{
      Authorization:ADMIN_TOKEN,
      "Content-Type":"application/json"
    },
    body:JSON.stringify({videoid:id})
  });
  load();
}

function refresh(){ load(); }

/* ================= INIT ================= */
load();
</script>

</body>
</html>
