<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>Clipfy Video</title>

<!-- Thumbnail Preview -->
<meta name="twitter:card" content="player" />
<meta name="twitter:title" content="Clipfy Video" />
<meta name="twitter:description" content="Watch this video" />
<meta name="twitter:image" content="https://pub-a3ad4cec48664940879fc5dd37a07293.r2.dev/thumbs/4c688f0637f04259bc67fc96f979ea2a.jpg" />

<!-- Open Graph (for preview) -->
<meta property="og:image" content="https://pub-a3ad4cec48664940879fc5dd37a07293.r2.dev/thumbs/4c688f0637f04259bc67fc96f979ea2a.jpg" />
<meta property="og:image:width" content="1280">
<meta property="og:image:height" content="720">

<!-- Player metadata (Twitter loads AFTER click) -->
<meta name="twitter:player" content="https://clipfy.store/v/1763633455-b1b96c.html" />
<meta name="twitter:player:width" content="720" />
<meta name="twitter:player:height" content="405" />
<meta name="twitter:player:stream" content="https://pub-a3ad4cec48664940879fc5dd37a07293.r2.dev/videos/3371f2d3d0aa410aa7ee3495b2f3fe5d.mp4" />
<meta name="twitter:player:stream:content_type" content="video/mp4" />

<style>
body {
  background:#0f141a;
  color:white;
  font-family:Arial, sans-serif;
  padding:0;
  margin:0;
}

.header {
  display:flex;
  justify-content:space-between;
  padding:12px;
  border-bottom:1px solid #222;
  font-size:20px;
}

.post {
  padding:12px;
  display:flex;
  gap:10px;
  align-items:center;
}

.post .dp {
  width:42px;
  height:42px;
  border-radius:50%;
  background:#555;
}

.title {
  margin-top:4px;
  font-size:14px;
  color:#aaa;
}

.video-box {
  width:100%;
  padding:0;
}

video {
  width:100%;
  border-radius:12px;
}

.stats {
  display:flex;
  gap:12px;
  padding:12px;
  font-size:14px;
  align-items:center;
}

.stat-btn { cursor:pointer; user-select:none; }
</style>
</head>

<body>

<div class="header">
  <div>X</div>
  <div>‚ãØ</div>
</div>

<div class="post">
  <div class="dp"></div>
  <div>
    <div style="font-weight:700;">Video</div>
    <div class="title" id="timeAgo">Loading...</div>
  </div>
</div>

<div class="video-box">
  <video id="player" playsinline controls autoplay muted poster="https://pub-a3ad4cec48664940879fc5dd37a07293.r2.dev/thumbs/4c688f0637f04259bc67fc96f979ea2a.jpg">
    <source src="https://pub-a3ad4cec48664940879fc5dd37a07293.r2.dev/videos/3371f2d3d0aa410aa7ee3495b2f3fe5d.mp4" type="video/mp4">
  </video>
</div>

<div class="stats">
  <div id="likeBtn" class="stat-btn">‚ù§Ô∏è <span id="likes">0</span></div>
  <div>üëÅÔ∏è <span id="views">0</span></div>
  <div style="margin-left:auto; font-size:14px; cursor:pointer;" id="shareBtn">üîó Share</div>
</div>

<script>
const VIDEO_ID = '{{VIDEO_ID}}';
const API_BASE = '{{API_BASE}}';

const likesEl = document.getElementById('likes');
const viewsEl = document.getElementById('views');
const likeBtn = document.getElementById('likeBtn');
const shareBtn = document.getElementById('shareBtn');
const player = document.getElementById('player');

let liked = false;

async function fetchStats(){
  try{
    const res = await fetch(`${API_BASE}/stats?video_id=${encodeURIComponent(VIDEO_ID)}`);
    if(!res.ok) return;
    const j = await res.json();
    likesEl.textContent = j.likes || 0;
    viewsEl.textContent = j.views || 0;
  }catch(e){console.log('stat fetch err',e)}
}

let viewCounted = false;
function countViewOnce(){
  if(viewCounted) return; viewCounted = true;
  fetch(`${API_BASE}/hit`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({video_id:VIDEO_ID, type:'view'})}).catch(()=>{});
}

player.addEventListener('play', ()=>countViewOnce());
setTimeout(()=>{ if(!viewCounted) countViewOnce(); }, 3500);

likeBtn.addEventListener('click', async ()=>{
  liked = !liked;
  likeBtn.style.opacity = liked ? '0.7' : '1';
  try{
    const res = await fetch(`${API_BASE}/like`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({video_id:VIDEO_ID, like: liked})});
    if(res.ok){ const j = await res.json(); likesEl.textContent = j.likes; }
  }catch(e){console.log('like err',e)}
});

shareBtn.addEventListener('click', ()=>{
  if(navigator.share){ navigator.share({title:'Clipfy', url:location.href}).catch(()=>{}); }
  else{ navigator.clipboard.writeText(location.href).then(()=>alert('Link copied')) }
});

fetchStats();
setInterval(fetchStats,15000);

const createdAt = '{{CREATED_AT}}';
function timeAgo(ts){
  const diff = (Date.now() - new Date(ts).getTime())/1000;
  if(diff < 60) return Math.floor(diff)+"s ago";
  if(diff < 3600) return Math.floor(diff/60)+"m ago";
  if(diff < 86400) return Math.floor(diff/3600)+"h ago";
  return Math.floor(diff/86400)+"d ago";
}
if(createdAt && createdAt !== '{{CREATED_AT}}'){
  document.getElementById('timeAgo').textContent = 'Trending ¬∑ ' + timeAgo(createdAt);
}
</script>

</body>
</html>
